<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animation X-Sheet (Web)</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="app-container">
        <header class="app-header">
            <button id="btnImportAudio">Import Audio</button>
            <input type="file" id="fileInputAudio" accept="audio/*" style="display: none;">

            <button id="btnSaveProject">Save Project</button>
            <input type="file" id="fileInputLoadProject" accept=".json" style="display: none;">
            <button id="btnLoadProject">Load Project</button>

            <button id="btnExportPDF">Export PDF</button>

            <label for="framesInput">Frames:</label>
            <input type="number" id="framesInput" value="48" min="1" step="1">

            <label for="fpsInput">FPS:</label>
            <input type="number" id="fpsInput" value="24" min="1" step="1">
        </header>

        <div class="main-content-area">
            <aside id="left-toolbar">
                <div class="tool-group-title">Drawing Tools</div>
                <button data-tool="select" title="Select Tool">üëÜ</button>
                <button data-tool="pen" title="Pen Tool" class="active-tool">‚úèÔ∏è</button>
                <button data-tool="line" title="Line Tool">‚Äî</button>
                <button data-tool="rectangle" title="Rectangle Tool">‚ñ°</button>
                <button data-tool="ellipse" title="Ellipse Tool">‚óã</button>
                <hr>
                <label for="drawingColor">Color:</label>
                <input type="color" id="drawingColor" value="#FF0000">
                <label for="lineWidth">Width:</label>
                <select id="lineWidth">
                    <option value="1">1px</option>
                    <option value="2" selected>2px</option>
                    <option value="3">3px</option>
                    <option value="5">5px</option>
                </select>
                <hr>
                <button id="btnClearAllDrawings">Clear Drawings</button>
            </aside>

            <section id="xsheet-and-metadata-section">
                <div id="metadata-grid">
                    <div><span>Project #:</span><input type="text" id="metaProjectNumber"></div>
                    <div><span>Date:</span><input type="date" id="metaDate"></div>
                    <div><span>Page #:</span><input type="text" id="metaPageNumber" value="1"></div>
                    <div><span>Animator:</span><input type="text" id="metaAnimatorName"></div>
                    <div><span>Version:</span><input type="text" id="metaVersionNumber" value="1.0"></div>
                    <div><span>Shot #:</span><input type="text" id="metaShotNumber"></div>
                </div>

                <!-- This is the scrollable container for the X-Sheet table -->
                <div id="xsheet-container">
                    <table id="xsheetTable">
                        <thead id="xsheetTableHead">
                            <!-- Headers generated by xsheet.js -->
                        </thead>
                        <tbody id="xsheetTableBody">
                            <!-- Rows generated by xsheet.js -->
                        </tbody>
                    </table>
                    <!-- Vertical Waveform Canvas is appended here by xsheet.js -->
                    <!-- Drawing Canvas Overlay will be appended here by drawingCanvas.js -->
                </div>
            </section>
        </div>

        <footer class="app-footer">
            <div id="audio-playback-controls">
                <button id="btnPlay">Play</button>
                <button id="btnPause" style="display:none;">Pause</button>
                <button id="btnStop">Stop</button>
                <span id="audioInfo">No audio loaded</span>
                <input type="range" id="audioScrubSlider" min="0" max="1000" value="0" disabled>
            </div>
            <div id="statusBar">Status: Ready</div>
        </footer>
    </div>

    <!-- SCRIPTS - Order is critical for proper functionality! -->
    <!-- Add a console initialization script to catch early errors -->
    <script>
        // Simple error catching to help diagnose issues
        window.addEventListener('error', function (event) {
            console.error('Script error detected:', event.filename, 'Line:', event.lineno, 'Error:', event.message);
        });
        console.log("Starting to load scripts...");
    </script>

    <!-- External libraries - Load in correct order -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Application scripts - Load in dependency order -->
    <script src="js/projectData.js"></script>
    <script src="js/audioHandler.js"></script>
    <script src="js/xsheet.js"></script>
    <script src="js/drawingTools.js"></script>
    <script src="js/drawingCanvas.js"></script>
    <script src="js/exportHandler.js"></script>
    <script src="js/main.js"></script>

    <script>
        // Verify all required objects are loaded
        window.addEventListener('load', function () {
            console.log("All scripts loaded. Checking dependencies...");
            const requiredObjects = ['ProjectData', 'AudioHandler', 'XSheet'];
            const requiredNamespaces = ['XSheetApp.DrawingTools', 'XSheetApp.DrawingCanvas', 'XSheetApp.ExportHandler'];

            let allLoaded = true;

            requiredObjects.forEach(obj => {
                if (typeof window[obj] === 'undefined') {
                    console.error(`Missing required object: ${obj}`);
                    allLoaded = false;
                }
            });

            requiredNamespaces.forEach(ns => {
                const parts = ns.split('.');
                let current = window;
                for (let part of parts) {
                    if (!current[part]) {
                        console.error(`Missing required namespace: ${ns}`);
                        allLoaded = false;
                        break;
                    }
                    current = current[part];
                }
            });

            if (allLoaded) {
                console.log("‚úì All dependencies loaded successfully");
            } else {
                console.error("‚úó Some dependencies failed to load - check script order and file paths");
            }
        });
    </script>
</body>

</html>